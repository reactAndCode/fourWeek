# 작업 일지: 내방문리뷰 기능 구현 (2026-02-19)

## 1. 작업 개요
- **기능명**: 내방문리뷰 (Visit Review)
- **주요 목적**: 방문한 장소에 대한 리뷰를 기록하고 지도(Google Maps)상에서 위치를 확인하는 유틸리티 기능 추가
- **기술 스택**: Next.js 15, Supabase (Database/Auth), Tailwind CSS v4, @react-google-maps/api

## 2. 주요 작업 내용

### 가. 메뉴 및 내비게이션 구성
- `마이유틸` 사이드바에 "내방문리뷰" 메뉴 추가
- 메인 페이지(`app/myutils/page.tsx`)와 연동하여 조건부 렌더링 구현

### 나. UI 및 컴포넌트 개발 (`components/myutils/visit-review.tsx`)
- **구글 지도 연동**: 서울특별시청(37.5665, 126.9780)을 초기 중심으로 하여 지도 표시
- **리뷰 목록**: 좌측 사이드바에 카드 형태의 리뷰 목록 구현 (검색 및 필터링 기능 포함)
- **리뷰 추가 모달**: 장소명, 주소, 평점, 본문, 방문일자를 입력받는 모달 폼 구현
- **상세 정보**: 지도상 마커 선택 또는 리스트 클릭 시 하단 상세 오버레이 노출
- **높이 조정**: 사용자 요청에 맞춰 지도 컨테이너 높이 조정 (최종 `700px`)

### 다. 데이터베이스 설계 및 적용
- **테이블 생성**: `visit_reviews` 테이블 정의 (SQL 스크립트 작성)
- **보안 설정**: 본인이 작성한 데이터만 관리할 수 있도록 **RLS(Row Level Security)** 정책 적용 및 인덱스 최적화
- **실시간 반영**: `updated_at` 자동 업데이트를 위한 DB 트리거 설정

### 라. API 연동 및 데이터 영구 저장
- **타입 정의**: `types/database.types.ts`에 Supabase 테이블 스키마 정보 동기화
- **API 레이어**: `lib/api/visit-review.ts`에서 CRUD(조회, 생성, 삭제) 함수 구현
- **프론트엔드 연동**: 더미 데이터 기반에서 Supabase Real-time 데이터 연동으로 전환 완료

### 마. UI 개선 및 좌표 입력 정확도 향상 (2026-02-19 추가)
- **리뷰 추가 모달 개선**: 
    - 리뷰 내용 입력창(`Textarea`)의 세로 높이 축소 (`min-h-[60px]`)
    - 주소 입력창 아래에 **위도(Latitude)** 및 **경도(Longitude)** 수동 입력창 추가 (1열 2컬럼 구성)
- **좌석 연동 로직 수정**:
    - 모달 오픈 시 현재 지도 중심 좌표를 위도/경도 입력창의 초기값으로 자동 할당
    - 리뷰 저장 시 지도 중심이 아닌, 입력창에 기재된(또는 수정된) 정확한 좌표값을 저장하도록 개선
- **주소 기반 좌표 자동 계산**:
    - 주소 입력창에서 주소 입력 후 `Enter` 키 입력 시 Google Geocoding API를 통해 위도/경도를 자동으로 계산하여 필드에 채워주는 기능 추가
    - 계산 성공 시 지도 중심도 해당 위치로 자동 이동
> [!WARNING]
> **API 권한 설정 필요**: 이 기능을 사용하려면 Google Cloud Console에서 `Geocoding API`가 활성화되어 있어야 하며, 사용 중인 API 키에 해당 API 호출 권한이 부여되어 있어야 합니다. (현재 'not authorized' 오류 발생 시 체크 필요)

### 바. 직접 접속 페이지 생성 (2026-02-19 추가)
- **페이지 신설**: `app/myp/page.tsx`를 생성하여 `localhost:3000/myp` 주소로 내방문리뷰 기능만 단독으로 사용할 수 있도록 구현
- **주요 기능**:
    - `myutils`와 동일한 사용자 인증(Auth) 체크 적용
    - 상단 헤더에 '목록으로' 버튼을 추가하여 메인 유틸리티 페이지로 쉽게 돌아갈 수 있게 구성
    - 독립적인 레이아웃으로 넓고 쾌적한 지도 화면 제공

### 사. 빌드 준비 및 검증 (2026-02-19 추가)
- **빌드 테스트**: `npm run build`를 통해 프로덕션 빌드 환경에서 TypeScript 및 Lint 에러가 없음을 확인 완료
- **환경 변수**: `.env.local`의 API 키 설정이 빌드 프로세스에 정상적으로 반영됨을 확인

## 3. 작업 파일 리스트

### 프론트엔드 (UI/Logic)
- [MODIFY] [sidebar.tsx](file:///d:/dev/vibe_coding/four_nextjs/components/myutils/sidebar.tsx): 사이드바 메뉴 추가
- [MODIFY] [page.tsx](file:///d:/dev/vibe_coding/four_nextjs/app/myutils/page.tsx): 메뉴 전환 로직 추가
- [NEW] [visit-review.tsx](file:///d:/dev/vibe_coding/four_nextjs/components/myutils/visit-review.tsx): 방문 리뷰 메인 컴포넌트
- [NEW] [visit-review.ts](file:///d:/dev/vibe_coding/four_nextjs/lib/api/visit-review.ts): Supabase CRUD API 레이어
- [MODIFY] [database.types.ts](file:///d:/dev/vibe_coding/four_nextjs/types/database.types.ts): DB 테이블 타입 추가

### 인프라 및 DB
- [NEW] [VISIT_REVIEWS_SETUP.sql](file:///d:/dev/vibe_coding/four_nextjs/VISIT_REVIEWS_SETUP.sql): Supabase 테이블 & 정책 생성 스크립트
- [MODIFY] [CLAUDE.md](file:///d:/dev/vibe_coding/four_nextjs/CLAUDE.md): 프로젝트 명세 및 DB 스키마 로그 업데이트

## 4. 특이사항 및 향후 과제
- Google Maps API 키는 `.env.local`의 `NEXT_PUBLIC_GOOGLE_MAPS_API_KEY`를 사용함
- 현재 검색 기능은 클라이언트 사이드에서 작동하며, 데이터가 많아질 경우 서버 사이드 검색으로 전환 고려 필요
- 이미지 업로드(Supabase Storage 연동) 기능 추가 가능성 열어둠
